<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>The Game â€“ Online</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
body {
  background: #121212;
  color: #f2f2f2;
  font-family: system-ui;
  text-align: center;
  padding: 20px;
}

.piles {
  display: grid;
  grid-template-columns: repeat(2, 140px);
  gap: 20px;
  justify-content: center;
}

.pile {
  background: #1e1e1e;
  border: 2px solid #555;
  border-radius: 14px;
  padding: 15px;
  cursor: pointer;
}

.pile.valid {
  border-color: #4caf50;
  box-shadow: 0 0 10px #4caf50;
}

.card {
  background: #2c2c2c;
  display: inline-block;
  padding: 12px 18px;
  margin: 8px;
  border-radius: 12px;
  cursor: pointer;
}

button {
  padding: 10px 16px;
  margin-top: 15px;
  border-radius: 8px;
  border: none;
  background: #4caf50;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>The Game ğŸƒ</h1>

<input id="room" placeholder="Lobby-Code">
<button onclick="join()">Beitreten</button>

<h3 id="info"></h3>

<div class="piles" id="piles"></div>

<h2>Deine Karten</h2>
<div id="hand"></div>

<button id="endTurn" onclick="endTurn()" style="display:none">
Zug beenden
</button>

<div id="overlay"></div>

<script>
const socket = io("https://the-game-server-h9br.onrender.com");

let room="", myId="", game=null, selectedCard=null;

function join(){
  room=document.getElementById("room").value;
  socket.emit("join", room);
}

socket.on("state", g=>{
  game=g;
  myId ??= socket.id;
  render();
});

function isValid(card,pile,val){
  return pile.startsWith("up")
    ? card>val || card===val-10
    : card<val || card===val+10;
}

function render(){
  if(!game) return;

  if(game.status!=="playing"){
    document.getElementById("overlay").innerHTML=
      `<h1>${game.status==="win"?"ğŸ‰ GEWONNEN":"ğŸ’€ VERLOREN"}</h1>
       <button onclick="rematch()">Rematch</button>`;
    return;
  }

  document.getElementById("info").innerText =
    game.turn===myId
    ? `Dein Zug â€“ Karten gespielt: ${game.playedThisTurn[myId]}/2`
    : `Warten auf Mitspieler`;

  document.getElementById("endTurn").style.display =
    game.turn===myId && game.playedThisTurn[myId]>=2
    ? "inline-block" : "none";

  const piles=document.getElementById("piles");
  piles.innerHTML="";

  for(const p in game.piles){
    const d=document.createElement("div");
    d.className="pile";
    d.innerText=`${p}\n${game.piles[p]}`;

    if(
      selectedCard &&
      isValid(selectedCard,p,game.piles[p])
    ) d.classList.add("valid");

    d.onclick=()=>play(p);
    piles.appendChild(d);
  }

  const hand=document.getElementById("hand");
  hand.innerHTML="";
  game.players[myId]?.forEach(c=>{
    const el=document.createElement("div");
    el.className="card";
    el.innerText=c;
    el.onclick=()=>{selectedCard=c;render();}
    hand.appendChild(el);
  });
}

function play(pile){
  if(!selectedCard) return;
  socket.emit("play",{room,card:selectedCard,pile});
  selectedCard=null;
}

function endTurn(){
  socket.emit("endTurn",room);
}

function rematch(){
  socket.emit("rematch",room);
  document.getElementById("overlay").innerHTML="";
}
</script>

</body>
</html>
